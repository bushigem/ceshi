# AgriShopper 项目启动指南

## 项目概述

AgriShopper 是一个基于 Spring Boot 3 + Vue 3 的全栈项目，包含以下组件：

- **后端**: Spring Boot 3 + Spring Security + MyBatis Plus
- **前端**: Vue 3 + Vite + TypeScript + Element Plus
- **数据库**: MySQL 8.0
- **缓存**: Redis 7.2
- **对象存储**: MinIO
- **任务调度**: XXL-Job

## 技术栈详情

### 后端技术栈
- **Java**: JDK 17 (LTS)
- **Spring Boot**: 3.x
- **Spring Security**: 6.x
- **MyBatis Plus**: 3.5.x
- **Maven**: 3.9.x
- **MySQL**: 8.0
- **Redis**: 7.2
- **MinIO**: 最新版本
- **XXL-Job**: 2.4.x

### 前端技术栈
- **Node.js**: 22.x (LTS)
- **Vue**: 3.x
- **Vite**: 5.x
- **TypeScript**: 5.x
- **Element Plus**: 2.x
- **Pinia**: 2.x
- **Vue Router**: 4.x
- **Axios**: 1.x

## 环境要求

### 必需环境

#### Java 环境
- **Java**: JDK 17 或更高版本
- **下载地址**: 
  - [Oracle JDK 17](https://www.oracle.com/java/technologies/downloads/#java17)
  - [OpenJDK 17](https://adoptium.net/temurin/releases/?version=17)
  - [Amazon Corretto 17](https://docs.aws.amazon.com/corretto/latest/corretto-17-ug/downloads-list.html)

#### Maven 环境
- **Maven**: 3.9.x 或更高版本
- **下载地址**: [Apache Maven](https://maven.apache.org/download.cgi)
- **安装指南**: [Maven 安装教程](https://maven.apache.org/install.html)

#### Node.js 环境
- **Node.js**: 22.x (LTS) 或更高版本
- **下载地址**: 
  - [Node.js 官网](https://nodejs.org/)
  - [Node.js 22.x LTS](https://nodejs.org/dist/v22.19.0/)
- **包管理器**: pnpm (推荐) 或 npm
  - pnpm 安装: `npm install -g pnpm`

#### 数据库环境
- **MySQL**: 8.0 或更高版本
- **下载地址**: 
  - [MySQL 8.0](https://dev.mysql.com/downloads/mysql/)
  - [MySQL Community Server](https://dev.mysql.com/downloads/mysql/)

#### 缓存环境
- **Redis**: 7.2 或更高版本
- **下载地址**: 
  - [Redis 官网](https://redis.io/download)
  - [Redis 7.2](https://download.redis.io/redis-stable.tar.gz)

### 开发工具

#### IDE 推荐
- **后端开发**: 
  - [IntelliJ IDEA](https://www.jetbrains.com/idea/download/) (推荐)
  - [Eclipse](https://www.eclipse.org/downloads/)
  - [VS Code](https://code.visualstudio.com/) + Java 插件
- **前端开发**: 
  - [Visual Studio Code](https://code.visualstudio.com/) (推荐)
  - [WebStorm](https://www.jetbrains.com/webstorm/)

#### 数据库管理工具
- **MySQL 管理**: 
  - [Navicat](https://www.navicat.com/)
  - [MySQL Workbench](https://dev.mysql.com/downloads/workbench/)
  - [DBeaver](https://dbeaver.io/) (免费)
- **Redis 管理**: 
  - [Redis Desktop Manager](https://redisdesktop.com/)
  - [Another Redis Desktop Manager](https://github.com/qishibo/AnotherRedisDesktopManager) (免费)

#### API 测试工具
- **Postman**: [下载地址](https://www.postman.com/downloads/)
- **Apifox**: [下载地址](https://www.apifox.cn/)

### 容器化环境
- **Docker**: 用于运行依赖服务容器
  - [Docker Desktop](https://www.docker.com/products/docker-desktop/)
  - [Docker Engine](https://docs.docker.com/engine/install/)
- **Docker Compose**: 用于编排多个服务
  - 通常随 Docker Desktop 一起安装
  - [Docker Compose 独立安装](https://docs.docker.com/compose/install/)

## 环境检查

在开始之前，请确保以下命令能够正常执行：

```bash
# 检查 Java 版本
java -version

# 检查 Maven 版本
mvn -version

# 检查 Node.js 版本
node -v

# 检查 npm 版本
npm -v

# 检查 pnpm 版本
pnpm -v

# 检查 Docker 版本
docker -v

# 检查 Docker Compose 版本
docker-compose -v
```

预期输出示例：
```
java version "17.0.9" 2023-10-17 LTS
Apache Maven 3.9.5
v22.19.0
10.2.4
8.15.4
Docker version 24.0.7
Docker Compose version v2.23.3
```

## 启动依赖服务

### 1. 启动依赖服务

进入后端目录的 docker 文件夹：

```bash
cd backend/docker
```

启动所有依赖服务：

```bash
docker-compose up -d
```

这将启动以下服务：
- MySQL (端口: 3306, 密码: 123456)
- Redis (端口: 6379, 密码: 123456)
- MinIO (端口: 9000, 控制台: 9001, 用户名/密码: minioadmin/minioadmin)
- XXL-Job (端口: 8080)

### 2. 验证服务启动

检查所有服务是否正常启动：

```bash
docker-compose ps
```

### 3. 查看服务日志

如果需要查看某个服务的日志：

```bash
# 查看所有服务日志
docker-compose logs

# 查看特定服务日志
docker-compose logs mysql
docker-compose logs redis
docker-compose logs minio
docker-compose logs xxl-job-admin
```

### 4. 数据库初始化

数据库会自动初始化，如果需要手动执行：

```bash
# 连接到 MySQL
docker exec -it mysql mysql -u root -p123456

# 查看数据库
SHOW DATABASES;

# 使用数据库
USE youlai_boot;

# 查看表
SHOW TABLES;
```

## 启动后端服务

### 1. 进入后端目录

```bash
cd backend
```

### 2. 编译项目

```bash
# 使用 Maven 编译
mvn clean compile

# 或者使用 Maven Wrapper
./mvnw clean compile
```

### 3. 启动应用

```bash
# 开发环境启动
mvn spring-boot:run

# 或者直接运行主类
mvn exec:java -Dexec.mainClass="com.youlai.boot.YouLaiBootApplication"
```

### 4. 验证后端启动

访问以下地址验证服务是否正常：
- 应用主页: http://localhost:8989
- API 文档: http://localhost:8989/doc.html
- Swagger UI: http://localhost:8989/swagger-ui/index.html

## 启动前端服务

### 1. 进入前端目录

```bash
cd frontend
```

### 2. 安装依赖

npm install -g pnpm

```bash
# 使用 pnpm (推荐)
pnpm install

# 或者使用 npm
npm install
```

### 3. 启动开发服务器

```bash
# 开发环境启动
pnpm dev

# 或者使用 npm
npm run dev
```

### 4. 验证前端启动

访问 http://localhost:5173 查看前端应用

## 配置说明

### 后端配置

主要配置文件位于 `backend/src/main/resources/`：

- `application.yml`: 主配置文件
- `application-dev.yml`: 开发环境配置
- `application-prod.yml`: 生产环境配置

关键配置项：
- 数据库连接: `spring.datasource`
- Redis 配置: `spring.data.redis`
- 服务端口: `server.port` (默认: 8989)

### 前端配置

主要配置文件：
- `vite.config.ts`: Vite 构建配置
- `.env.development`: 开发环境变量
- `.env.production`: 生产环境变量

关键配置项：
- 开发服务器端口: `VITE_APP_PORT` (默认: 5173)
- API 代理: `VITE_APP_BASE_API` 和 `VITE_APP_API_URL`

## 常见问题

### 1. 端口冲突

如果端口被占用，可以修改配置文件中的端口号：

**后端端口修改** (`backend/src/main/resources/application-dev.yml`):
```yaml
server:
  port: 8989  # 修改为其他可用端口
```

**前端端口修改** (`frontend/.env.development`):
```
VITE_APP_PORT=5173  # 修改为其他可用端口
```

### 2. 数据库连接失败

检查以下几点：
- Docker 容器是否正常启动：`docker-compose ps`
- 数据库连接信息是否正确
- 容器网络是否正常：`docker network ls`

### 3. Redis 连接失败

检查以下几点：
- Redis 容器是否正常启动：`docker-compose ps`
- Redis 密码是否正确
- 容器端口映射是否正确：`docker port redis`

### 4. 前端无法访问后端 API

检查以下几点：
- 后端服务是否正常启动
- 代理配置是否正确
- 跨域配置是否正确



## 部署说明

### 后端部署

1. 打包应用：
   ```bash
   mvn clean package -Dmaven.test.skip=true
   ```

2. 运行 JAR 包：
   ```bash
   java -jar target/youlai-boot-3.0.0.jar
   ```

### 前端部署

1. 构建生产版本：
   ```bash
   pnpm build
   ```

2. 部署 `dist` 目录到 Web 服务器

## 停止服务

### 停止 Docker 服务

```bash
cd backend/docker
docker-compose down
```

### 停止后端服务

在运行后端服务的终端中按 `Ctrl + C`

### 停止前端服务

在运行前端服务的终端中按 `Ctrl + C`

### 重启 Docker 服务

```bash
cd backend/docker
docker-compose restart
```

### 清理 Docker 数据（谨慎使用）

```bash
# 停止并删除容器
docker-compose down

# 删除数据卷（会丢失所有数据）
docker-compose down -v

# 重新创建并启动
docker-compose up -d
```

## 联系支持

如果在启动过程中遇到问题，请检查：
1. Docker 和 Docker Compose 是否正确安装
2. 环境版本是否符合要求
3. 配置文件是否正确
4. Docker 容器是否正常启动
5. 端口是否被占用

## Docker 常用命令

```bash
# 查看运行中的容器
docker ps

# 查看所有容器（包括停止的）
docker ps -a

# 查看容器日志
docker logs <容器名>

# 进入容器内部
docker exec -it <容器名> bash

# 查看容器资源使用情况
docker stats

# 清理未使用的资源
docker system prune
```

---

**注意**: 首次启动时，请确保 Docker 和 Docker Compose 已正确安装，并且所有依赖服务容器都已正常启动。 